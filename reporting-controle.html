<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Controle & Indienen</title>
  <style>
    /* ... je bestaande styles ... */
    .status { /* zoals eerder */ }
    .status.success { /* zoals eerder */ }
    .status.warning { /* nieuw: voor waarschuwingen */ 
      background: #fff3cd;
      color: #856404;
      border-left: 4px solid #ffeeba;
    }
    .status.error { /* zoals eerder */ }
  </style>
</head>
<body>
  <div class="box">
    <h2>Stuur uw rapportage in</h2>
    <h3>Controleer of T 01.01 is gevalideerd.</h3>
    <span id="statusBox" class="status error">
      ❌ Validatie wordt uitgevoerd…
    </span>
    <button id="submitBtn" disabled>📤 Indienen rapportage</button>
  </div>

  <iframe id="validatorFrame" src="reporting-t01-01.html" style="display:none;"></iframe>

  <script>
    const statusBox = document.getElementById('statusBox');
    const submitBtn = document.getElementById('submitBtn');
    const validator = document.getElementById('validatorFrame');

    // Zodra de iframe geladen is, vraag validatie aan
    validator.addEventListener('load', () => {
      validator.contentWindow.postMessage({ action: 'runValidation' }, '*');
    });

    // Ontvang het validatieresultaat
    window.addEventListener('message', evt => {
      if (evt.data.action !== 'validationResult') return;
      const { errs, warns } = evt.data;

      if (errs.length > 0) {
        // Als er errors zijn: blokkeren
        statusBox.textContent =
          `❌ Validatie mislukt: ${errs.length} error(s).`;
        statusBox.className = 'status error';
        submitBtn.disabled = true;
      } else if (warns.length > 0) {
        // Geen errors, wel warnings: allow submit, maar toon warning
        statusBox.textContent =
          `⚠️ Gevalideerd met ${warns.length} warning(s). Indienen mogelijk.`;
        statusBox.className = 'status warning';
        submitBtn.disabled = false;
      } else {
        // Geen errors én geen warnings: volledig groen
        statusBox.textContent = '✅ T 01.01 is gevalideerd. Indienen mogelijk.';
        statusBox.className = 'status success';
        submitBtn.disabled = false;
      }
    });

    // Fictieve indien-actie
    submitBtn.addEventListener('click', () => {
      alert('📨 Rapportage is (demo) succesvol ingediend!');
    });
  </script>
</body>
</html>


<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Mijn DNB – Reporting App</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f9f9fb; }
    header { background:#004080; color:#fff; padding:15px 30px; font-size:1.4em; }
    .app-container { display:flex; height:calc(100vh - 50px); }
    .sidebar { width:240px; background:#f0f6ff; border-right:1px solid #ccc; overflow-y:auto; }
    .sidebar h3 { margin:20px; color:#004080; }
    .sidebar button { width:100%; padding:10px; border:none; background:transparent; text-align:left; cursor:pointer; }
    .sidebar button.active { background:#d0e9ff; font-weight:bold; }
    .content { flex:1; padding:20px; overflow-y:auto; }
    .view { display:none; }
    .view.active { display:block; }
    .card { background:#fff; border:1px solid #ddd; border-radius:6px; padding:20px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
    .card h3 { margin-top:0; color:#002d9c; }
    .card p { color:#555; font-size:0.9em; }
    .card input { display:none; }
    .card button { margin-top:10px; background:#002d9c; color:#fff; border:none; padding:8px 16px; border-radius:4px; cursor:pointer; }
    .card button:disabled { background:#aaa; cursor:not-allowed; }
    /* voeg hier eventuele extra CSS (tabellen etc.) toe */
  </style>
</head>
<body>

  <header>Mijn DNB – Reporting App</header>

  <div class="app-container">
    <div class="sidebar">
      <h3>Stap</h3>
      <button id="nav-start" class="active">1. Start</button>
      <button id="nav-toc">2. Overzicht</button>
      <button id="nav-form" disabled>3. Formulier</button>
    </div>

    <div class="content">
      <!-- VIEW 1: Start -->
      <div id="view-start" class="view active">
        <div class="card">
          <h3>Upload Excel-template</h3>
          <p>Gebruik uw ingevulde Excel-template of kies voor een lege rapportage.</p>
          <input type="file" id="excelUpload" accept=".xlsx,.xls">
          <button id="btnExcel" disabled>Excel kiezen…</button>
        </div>
        <div class="card">
          <h3>Upload XBRL-rapportage</h3>
          <input type="file" id="xbrlUpload" accept=".xbrl,.xml">
          <button id="btnXBRL" disabled>XBRL kiezen…</button>
        </div>
        <div class="card">
          <h3>Start lege rapportage</h3>
          <button id="btnBlank">Leeg formulier</button>
        </div>
      </div>

      <!-- VIEW 2: TOC -->
      <div id="view-toc" class="view">
        <h2>Reporting Obligations</h2>
        <table>
          <thead><tr><th>Report</th><th>Period</th><th>Status</th><th>Actie</th></tr></thead>
          <tbody id="tocBody">
            <!-- JavaScript vult hier de rijen in uit localStorage of default -->
          </tbody>
        </table>
      </div>

      <!-- VIEW 3: Formulier iframe -->
      <div id="view-form" class="view">
        <iframe id="formFrame" src="" style="width:100%; height:80vh; border:none;"></iframe>
      </div>
    </div>
  </div>

  <script>
    // NAVIGATIE
    const navStart = document.getElementById('nav-start'),
          navToc   = document.getElementById('nav-toc'),
          navForm  = document.getElementById('nav-form'),
          viewStart= document.getElementById('view-start'),
          viewToc  = document.getElementById('view-toc'),
          viewForm = document.getElementById('view-form');

    function show(view) {
      [viewStart,viewToc,viewForm].forEach(v=>v.classList.remove('active'));
      [navStart,navToc,navForm].forEach(b=>b.classList.remove('active'));
      if(view==='start'){ viewStart.classList.add('active'); navStart.classList.add('active'); }
      if(view==='toc')  { viewToc.classList.add('active');   navToc.classList.add('active'); }
      if(view==='form') { viewForm.classList.add('active');  navForm.classList.add('active'); }
    }
    navStart.addEventListener('click',()=>show('start'));
    navToc.addEventListener('click',()=>show('toc'));
    navForm.addEventListener('click',()=>show('form'));

    // EXCEL UPLOAD
    const excelInput = document.getElementById('excelUpload'),
          btnExcel   = document.getElementById('btnExcel');
    excelInput.addEventListener('change',()=>btnExcel.disabled=!excelInput.files.length);
    btnExcel.addEventListener('click',()=>{
      const file=excelInput.files[0], r=new FileReader();
      r.onload=e=>{
        const wb=XLSX.read(new Uint8Array(e.target.result),{type:'array'});
        wb.SheetNames.forEach(name=>{
          localStorage.setItem(name, JSON.stringify(
            XLSX.utils.sheet_to_json(wb.Sheets[name],{header:1})
          ));
        });
        navToc.disabled=false;
        show('toc');
        fillToc();
      };
      r.readAsArrayBuffer(file);
    });

    // XBRL UPLOAD
    const xbrlInput = document.getElementById('xbrlUpload'),
          btnXBRL   = document.getElementById('btnXBRL');
    xbrlInput.addEventListener('change',()=>btnXBRL.disabled=!xbrlInput.files.length);
    btnXBRL.addEventListener('click',()=>{
      const file=xbrlInput.files[0], r=new FileReader();
      r.onload=e=>{
        localStorage.setItem('XBRL', e.target.result);
        navToc.disabled=false; show('toc'); fillToc();
      };
      r.readAsText(file);
    });

    // BLANK start
    document.getElementById('btnBlank').addEventListener('click',()=>{
      navToc.disabled=false; show('toc'); fillToc();
    });

    // TOC vullen
    function fillToc(){
      const tocBody=document.getElementById('tocBody');
      tocBody.innerHTML='';
      // voorbeeld: sheets in localStorage
      const sheets = Object.keys(localStorage).filter(k=>k.match(/^T/));
      sheets.forEach(s=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${s}</td>
          <td>${localStorage[s] ? JSON.parse(localStorage[s])[0].join(' / ') : '-'}</td>
          <td>Open</td>
          <td><button onclick="openForm('${s}')">Open</button></td>
        `;
        tocBody.appendChild(tr);
      });
      navForm.disabled=false;
    }

    // Form in iframe laden
    function openForm(sheet){
      // map sheetnaam naar html-bestand
      const page = 'reporting-'+sheet.toLowerCase().replace('.','-')+'.html';
      document.getElementById('formFrame').src = page;
      navForm.disabled=false; show('form');
    }
  </script>

</body>
</html>
